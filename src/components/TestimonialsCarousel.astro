---
// import type { ImageMetadata } from "astro";
import { getBlurStyle } from "@utils/imageOptimization";

import { Image } from "astro:assets";


export interface ClientLogo {
  src: ImageMetadata;
  blurSrc: ImageMetadata;
  alt: string;
  companyName: string;
  testimonial: string;
  rating: number; // 1-5
}

interface Props {
  cards: ClientLogo[];
}

const { cards: logos } = Astro.props;

// Duplicate for seamless infinite loop
const duplicatedLogos = [...logos, ...logos, ...logos];
---

<section class="bg-background relative overflow-hidden py-12 md:py-16 lg:py-20">
  <div class="carousel-container">
    <div class="carousel-track group">
      {
        duplicatedLogos.map((logo, index) => {
          const blurStyle = getBlurStyle(logo.blurSrc.src);
          const isStaggered = index % 2 === 1;

          return (
            <div
              class:list={[
                "carousel-card",
                isStaggered && "translate-y-[6.6875rem]",
              ]}
            >
              <div class="relative flex h-full w-full flex-col rounded-[2.5rem] bg-[#19191914] p-6 shadow-[0px_4px_100px_10px_#2C2B2C63_inset,0px_4px_70px_0px_#E329B073] backdrop-blur-sm md:p-8">
                <div class="mb-4 flex items-start justify-between">
<!-- style={blurStyle}  -->
                    
                  <Image class="h-12 w-auto object-contain md:h-16" src={logo.src} alt={logo.alt}>

                  <div class="flex gap-1">
                    {Array.from({ length: 5 }, (_, i) => (
                      <svg
                        class:list={[
                          "h-5 w-5 md:h-6 md:w-6",
                          i < logo.rating
                            ? "fill-[#FFA500] text-[#FFA500]"
                            : "fill-gray-300 text-gray-300",
                        ]}
                        viewBox="0 0 20 20"
                        xmlns="http://www.w3.org/2000/svg"
                      >
                        <path d="M10 15l-5.878 3.09 1.123-6.545L.489 6.91l6.572-.955L10 0l2.939 5.955 6.572.955-4.756 4.635 1.123 6.545z" />
                      </svg>
                    ))}
                  </div>
                </div>

                <p class="text-sm leading-relaxed text-secondary md:text-base">
                  {logo.testimonial}
                </p>
              </div>
            </div>
          )
        })
      }
    </div>
  </div>
</section>

<style>
  .carousel-container {
    width: 100%;
    position: relative;
  }

  .carousel-track {
    display: flex;
    gap: 1.5rem;
    will-change: transform;
    animation: scroll-left var(--scroll-duration, 50s) linear infinite;
  }

  /* Pause on hover */
  .carousel-track:hover {
    animation-play-state: paused;
  }

  .carousel-card {
    flex-shrink: 0;
    width: min(90vw, 39.75rem); /* 636px max */
    height: 13.375rem; /* 214px */
    transition: transform 0.3s ease;
  }

  @keyframes scroll-left {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-33.333%); /* Move by 1/3 since we tripled */
    }
  }

  /* Responsive animation speeds */
  @media (max-width: 767px) {
    .carousel-container {
      --scroll-duration: 20s;
    }
    .carousel-card {
      width: min(85vw, 39.75rem);
    }
  }

  @media (min-width: 768px) and (max-width: 1023px) {
    .carousel-container {
      --scroll-duration: 20s;
    }
  }

  @media (min-width: 1024px) {
    .carousel-container {
      --scroll-duration: 20s;
    }
  }
</style>
